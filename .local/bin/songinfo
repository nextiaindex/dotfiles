#!/bin/sh

musicDir="$HOME/Music"
temp="/tmp/ncmpcpp"
jacket="${temp}/mpcNowPlaying.jpg"

mkdir -p "$temp"

trackMetadata=$(mpc --format 'File: %file%\nTitle: %title%\nArtist: %artist%\nAlbum: %album%' current)
trackFile="${trackMetadata#*File: }"
trackFile="${trackFile%%
*}"
trackTitle="${trackMetadata#*Title: }"
trackTitle="${trackTitle%%
*}"
trackArtist="${trackMetadata#*Artist: }"
trackArtist="${trackArtist%%
*}"
trackAlbum="${trackMetadata#*Album: }"

[ -z "$trackTitle" ] && trackTitle="${trackFile}"
rm -f "${jacket}"
ffmpeg -y -i "${musicDir}/${trackFile}" -an -c:v copy "${jacket}" 2>${temp}/mpc-notif.log && ICON_NOTIF="${jacket}" || ICON_NOTIF="library-music"
notify-send "Now Playing" "  $trackArtist"'\n'"󰎆  $trackTitle"'\n'"󰀥  $trackAlbum" --icon="${ICON_NOTIF}"
